<!DOCTYPE html>
<html lang="en" >

<head>
    <meta charset="UTF-8"><meta http-equiv="Content-Security-Policy"
content="default-src 'self';font-src 'self' data:;img-src 'self' https://* data:;media-src 'self';style-src 'self';frame-src player.vimeo.com https://www.youtube-nocookie.com;connect-src 'self';script-src 'self' 'self'">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="base" content="https://synex.space/">

    
    <title>
~/S9n3x • BIND9-DNS服务器配置</title>

    
    
    

    
    

    
    
    
        
            <link rel="stylesheet" href="https://synex.space/custom_subset.css?h=0b9535a28bc3d5bf2321">
        
    

    
        <link rel="stylesheet" href="https://synex.space/main.css?h=3716ab3457d2dd050b3c" />
        <link rel="stylesheet" href="https://synex.space/skins/mint.css?h=504215cf6bc10586b487" />

    <meta name="color-scheme" content="light dark" />
        <meta name="description" content="" />
        <meta property="og:description" content="" />

    

    <meta property="og:title" content="BIND9-DNS服务器配置" />
    <meta property="og:type" content="article" />

    
<meta property="og:locale" content="en_GB" />

    <meta property="og:url" content="https:&#x2F;&#x2F;synex.space&#x2F;blog&#x2F;bind9-dnsfu-wu-qi&#x2F;" /><meta property="og:site_name" content="~&#x2F;S9n3x">
        <noscript><link rel="stylesheet" href="https://synex.space/no_js.css"/></noscript>
        <script type="text/javascript" src="https://synex.space/js/initializeTheme.min.js"></script>
        <script defer src="https://synex.space/js/themeSwitcher.min.js"></script>
        <script defer src="https://synex.space/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e"></script>

        
    
</head>


<body>
    <a href="#main-content" id="skip-link">Skip to content</a>
    <header>
    <nav class="navbar">
        <div class="nav-title">
            <a class="home-title" href="https://synex.space/">~&#x2F;S9n3x</a>
        </div>
            <div class="nav-navs">
                <ul>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href="https://synex.space/blog/">blog
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href="https://synex.space/archive/">archive
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href="https://synex.space/tags/">tags
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href="https://synex.space/friends/">friends
                                </a>
                            </li>
                        <li class="menu-icons-container">
                        <ul class="menu-icons-group">
                            <li class="js menu-icon">
                                <div role="button" tabindex="0" id="search-button" class="search-icon interactive-icon" title="Click or press $SHORTCUT to open search" aria-label="Click or press $SHORTCUT to open search">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                                        <path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/>
                                    </svg>
                                </div>
                            </li>

                            
                            

                            <li class="theme-switcher-wrapper js"><div
        title="Toggle dark&#x2F;light mode"
        class="theme-switcher"
        tabindex="0"
        role="button"
        aria-label="Toggle dark mode"
        aria-pressed="false">
    </div><div
        title="Reset mode to default"
        class="theme-resetter arrow"
        tabindex="0"
        role="button"
        aria-hidden="true"
        aria-label="Reset mode to default">
    </div>

</li>
</ul>
                    </li>
                </ul>
            </div>
        
    </nav>
</header>

    <div class="content" id="main-content">

        
        





<main>
    <article class="h-entry">
        <h1 class="p-name article-title">
            BIND9-DNS服务器配置
        </h1>
        <a class="u-url u-uid" href="https://synex.space/blog/bind9-dnsfu-wu-qi/"></a>

        <ul class="meta"><span class="hidden p-author h-card">
<a rel="author" href="https:&#x2F;&#x2F;synex.space&#x2F;" class="u-url " title=""></a>
</span>
<li><time class="dt-published" datetime="2022-01-21T11:07:00">21st Jan 2022</time></li><li title="2313 words"><span class='separator' aria-hidden='true'>•</span>12 min read</li><li class="tag"><span class='separator' aria-hidden='true'>•</span>Tags:&nbsp;</li><li class="tag"><a class="p-category" href="https://synex.space/tags/dns/">DNS</a>,&nbsp;</li><li class="tag"><a class="p-category" href="https://synex.space/tags/wang-luo-fu-wu/">网络服务</a>,&nbsp;</li><li class="tag"><a class="p-category" href="https://synex.space/tags/bind9/">Bind9</a></li>
        </ul><section class="e-content body"><h1 id="dns">DNS</h1>
<p>DNS是将域名解析成IP地址的协议，有的时候也用于将IP地址反向解析成域名，也可以实现双向的解析。
<img src="https://image.boychai.xyz/article/DNS%26BIND9_1.jpg" alt="DNS在互联网中的关系" />
当客户端使用域名时会向DNS服务器发送请求，DNS会返回相应的IP给客户端之后客户端在向对应的IP发起请求。</p>
<h1 id="yu-ming">域名</h1>
<p>域名是网络上用于网络域、计算机、服务器等网络设备地址的标识。域名的结构如下图
<img src="https://image.boychai.xyz/article/DNS%26BIND9_2.jpg" alt="域名结构" />
<strong>结构:</strong> 域名是分层管理的,最高层的域名是根域"."就是一个点"."。
<strong>根域:</strong> 全世界只有13组根服务器，名字分别为A至M，其中10台设置在美国，另外三台设置于英国、瑞典、日本。顶级域名是由ICANN委任的注册机构负责运行。
<strong>二级域名:</strong> 二级域名不需要到ICANN进行申请，只需要到顶级域名的注册机构去检查带申请的名字是否可用，并且不是别人的商标时只需要缴纳一笔一年的费用即可得到相应的域名。</p>
<h1 id="bind9">BIND9</h1>
<p>BIND9是用于搭建DNS服务器的一个软件应用。</p>
<h2 id="an-zhuang">安装</h2>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# yum<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>y</span> install bind</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# named<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>v</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">BIND</span></span><span class="z-meta z-function-call z-arguments z-shell"> 9.11.26-RedHat-9.11.26-6.el8 (Extended Support Version</span><span class="z-meta z-function-call z-shell"></span>) <span class="z-keyword z-operator z-assignment z-redirection z-shell">&lt;</span>id:3ff8620<span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span>
</span></code></pre>
<h2 id="zhu-pei-zhi">主配置</h2>
<p>主配置文件为<code>/etc/named.conf</code></p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">//</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">//</span></span><span class="z-meta z-function-call z-arguments z-shell"> named.conf</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">//</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">//</span></span><span class="z-meta z-function-call z-arguments z-shell"> Provided by Red Hat bind package to configure the ISC BIND named(8</span><span class="z-meta z-function-call z-shell"></span>) <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">DNS</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">//</span></span><span class="z-meta z-function-call z-arguments z-shell"> server as a caching only nameserver (as a localhost DNS resolver only</span><span class="z-meta z-function-call z-shell"></span>)<span class="z-meta z-function-call z-shell"><span class="z-support z-function z-dot z-shell">.</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">//</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">//</span></span><span class="z-meta z-function-call z-arguments z-shell"> See /usr/share/doc/bind<span class="z-keyword z-operator z-regexp z-quantifier z-shell">*</span>/sample/ for example named configuration files.</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">//</span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">options</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        listen-on port 53 <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> 127.0.0.1; <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span>;    //监听的ipv4端口以及ip，需要改成自己的主机ip
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        listen-on-v6 port 53 <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> ::1; <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span>;    //监听的ipv6端口以及ip，改成自己的ipv6地址。用不到可以直注释掉
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        directory       <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/var/named<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;    //区域文件存放位置
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        dump-file       <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/var/named/data/cache_dump.db<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;    //当执行rndc dumpdb时服务器存放数据库文件路径名
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        statistics-file <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/var/named/data/named_stats.txt<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;    //当执行rndc stats命令的时候<span class="z-punctuation z-separator z-shell">,</span>服务器会统计信息追加到的文件路径
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        memstatistics-file <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/var/named/data/named_mem_stats.txt<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;    //服务器输出的内存使用统计文件路径
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        secroots-file   <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/var/named/data/named.secroots<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;    //安全根的保存位置
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        recursing-file  <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/var/named/data/named.recursing<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;    //递归查询数据的保存位置
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        allow-query     <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> localhost; <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span>;    //允许查询的ip<span class="z-punctuation z-separator z-shell">,</span>需要改为any
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        /<span class="z-keyword z-operator z-regexp z-quantifier z-shell">*</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">         - If you are building an AUTHORITATIVE DNS server<span class="z-punctuation z-separator z-shell">,</span> do NOT enable recursion.
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">         - If you are building a RECURSIVE (caching) DNS server<span class="z-punctuation z-separator z-shell">,</span> you need to enable
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">           recursion.
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">         - If your recursive DNS server has a public IP address<span class="z-punctuation z-separator z-shell">,</span> you MUST enable access
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">           control to limit queries to your legitimate users. Failing to do so will
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">           cause your server to become part of large scale DNS amplification
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">           attacks. Implementing BCP38 within your network would greatly
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">           reduce such attack surface
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        <span class="z-keyword z-operator z-regexp z-quantifier z-shell">*</span>/
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        recursion yes;    //允许递归查询
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        dnssec-enable yes;    //开启dnssec
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        dnssec-validation yes;    //设置dnssec在递归查询服务器上开启
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        managed-keys-directory <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/var/named/dynamic<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;    //指定目录中的文件储存<span class="z-punctuation z-separator z-shell">,</span>跟踪管理DNSSEC密钥
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        pid-file <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/run/named/named.pid<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;    //pid文件路径
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        session-keyfile <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/run/named/session.key<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;    //会话密钥路径
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        /<span class="z-keyword z-operator z-regexp z-quantifier z-shell">*</span> https://fedoraproject.org/wiki/Changes/CryptoPolicy <span class="z-keyword z-operator z-regexp z-quantifier z-shell">*</span>/
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        include <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/etc/crypto-policies/back-ends/bind.config<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">//</span></span><span class="z-meta z-function-call z-arguments z-shell"> 日志相关内容</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">logging</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        channel default_debug <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">                file <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>data/named.run<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">                severity dynamic;
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">//定义了根区域，没事可以看一下他这个区域文件</span></span><span class="z-meta z-function-call z-arguments z-shell">(/var/named/named.ca</span><span class="z-meta z-function-call z-shell"></span>)<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">，里面配置了13个根主机以及ipv4的地址还有ipv6的地址</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">zone</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>.<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> IN <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        type hint;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        file <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>named.ca<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">include</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/etc/named.rfc1912.zones<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">//标注的文件也作为配置生效，这个一般用于存放区域的配置</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">include</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/etc/named.root.key<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">//标注的文件也作为配置生效</span></span>
</span></code></pre>
<p>这个文件里面暂只需要修改的配置已列出：</p>
<ul>
<li><code>listen-on port 53 { 服务器的IP; };</code>    //监听的ipv4端口以及ip，需要改成自己的主机ip</li>
<li><code>allow-query     { any; };</code>    //允许查询的ip,需要改为any
其他配置看自己需求来</li>
</ul>
<h2 id="ge-chong-lei-xing-de-ji-lu">各种类型的记录</h2>
<p><strong>SOA记录:</strong> 起始授权记录 表示一个授权区域的开始
<strong>NS记录:</strong> 标识一个域的域名服务器
<strong>A记录:</strong> 将主机名转换为ipv4地址
<strong>AAAA记录:</strong> 将主机名转换为ipv6地址
<strong>CNAME记录:</strong> 别名记录 解析域名
<strong>MX记录:</strong> 邮件交换记录
<strong>PTR记录:</strong> 将地址转换成域名 反向解析</p>
<h2 id="pei-zhi-yi-ge-zheng-xiang-jie-xi-yu">配置一个正向解析域</h2>
<p>编辑区域文件<code>/etc/named.rfc1912.zones</code>在最底下添加内容</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# tail<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>n5</span> /etc/named.rfc1912.zones</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">zone</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>host.com.<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> IN <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        type master;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        file <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>host.com.zone<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        allow-update <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> none; <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span></code></pre>
<p><strong>zone:</strong> 定义一个区域写法为 <code>zone "域名." IN {配置}</code>
<strong>type:</strong> 设置类型为master
<strong>file:</strong> 设置区域的解析记录文件名称为host.com.zone
<strong>allow-update:</strong> 设置动态更新的ip，我这写的是none即不允许动态更新</p>
<p>现在设置此域名的解析记录，在<code>/var/named/</code>下创建对应文件host.com.zone并编辑</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> named]# pwd</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">/var/named</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> named]# touch host.com.zone</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> named]# vim host.com.zone</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell"> 600 IN SOA ns1.host.com. chai.simplefish.cn. (</span>
</span><span class="z-source z-shell z-bash">                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">202212101</span></span>      <span class="z-keyword z-operator z-logical z-continue z-shell">;</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">序列号，每次更新记录则需要修改</span></span>
</span><span class="z-source z-shell z-bash">                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">10800</span></span>          <span class="z-keyword z-operator z-logical z-continue z-shell">;</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">刷新时间，没隔多久到主服务器更新一次</span></span>
</span><span class="z-source z-shell z-bash">                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">900</span></span>            <span class="z-keyword z-operator z-logical z-continue z-shell">;</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">重试时间，应该小于刷新时间</span></span>
</span><span class="z-source z-shell z-bash">                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">604800</span></span>         <span class="z-keyword z-operator z-logical z-continue z-shell">;</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">过期时间，当辅助dns服务器无法联系主服务器的时间，超过这个时间则过期</span></span>
</span><span class="z-source z-shell z-bash">                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">86400</span></span>          <span class="z-keyword z-operator z-logical z-continue z-shell">;</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">非权威应答的ttl，缓存DNS记录多长时间</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"></span>)
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell"> 600 IN NS ns1.host.com.</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ns1.host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell"> 60 IN A 192.160.0.100</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">dns.host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell"> 60 IN A 192.160.0.100</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">bind.host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell"> 60 IN A 192.160.0.100</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">www.host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell"> 60 IN A 192.160.0.100</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> named]# systemctl start named    //启动服务</span>
</span></code></pre>
<p>一共有六条记录，其中SOA和NS记录时必须要有的。
记录写法为: 主机名 TTL值 IN 记录类型 值
在bind9里的所有配置文件中 所有的域名最后都必须带有"."，这个"."意味着根域的意思所以必须要有，不然启动服务的时候会报语法错误。</p>
<h2 id="ce-shi">测试</h2>
<p>打开自己电脑的CMD执行一下操作</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">C:<span class="z-constant z-character z-escape z-shell">\U</span>sers<span class="z-constant z-character z-escape z-shell">\S</span>impleFish</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span>nslookup    //使用nslookup工具</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">默认服务器:</span></span><span class="z-meta z-function-call z-arguments z-shell">  public1.114dns.com</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Address:</span></span><span class="z-meta z-function-call z-arguments z-shell">  114.114.114.114</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> server <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">192.168.0.100</span></span><span class="z-meta z-function-call z-arguments z-shell">          //server设置测试dns的服务器地址</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">默认服务器:</span></span><span class="z-meta z-function-call z-arguments z-shell">  <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>192.168<span class="z-punctuation z-separator z-collate z-begin z-shell">.</span>0<span class="z-punctuation z-separator z-collate z-end z-shell">.</span>100<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Address:</span></span><span class="z-meta z-function-call z-arguments z-shell">  192.168.0.100</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> set <span class="z-variable z-other z-readwrite z-assignment z-shell">type</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">any</span>                  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">//设置类型为any</span></span><span class="z-meta z-function-call z-arguments z-shell">(全部</span><span class="z-meta z-function-call z-shell"></span>)
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> host.com                      <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">//查看host.com的SOA记录</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">服务器:</span></span><span class="z-meta z-function-call z-arguments z-shell">  <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>192.168<span class="z-punctuation z-separator z-collate z-begin z-shell">.</span>0<span class="z-punctuation z-separator z-collate z-end z-shell">.</span>100<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Address:</span></span><span class="z-meta z-function-call z-arguments z-shell">  192.168.0.100</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">host.com</span></span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">primary</span></span><span class="z-meta z-function-call z-arguments z-shell"> name server = ns1.host.com</span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">responsible</span></span><span class="z-meta z-function-call z-arguments z-shell"> mail addr = chai.simplefish.cn</span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">serial</span></span><span class="z-meta z-function-call z-arguments z-shell">  = 202212101</span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">refresh</span></span><span class="z-meta z-function-call z-arguments z-shell"> = 10800 (3 hours</span><span class="z-meta z-function-call z-shell"></span>)
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">retry</span></span><span class="z-meta z-function-call z-arguments z-shell">   = 900 (15 mins</span><span class="z-meta z-function-call z-shell"></span>)
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">expire</span></span><span class="z-meta z-function-call z-arguments z-shell">  = 604800 (7 days</span><span class="z-meta z-function-call z-shell"></span>)
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">default</span></span><span class="z-meta z-function-call z-arguments z-shell"> TTL = 86400 (1 day</span><span class="z-meta z-function-call z-shell"></span>)
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">host.com</span></span><span class="z-meta z-function-call z-arguments z-shell">        nameserver = ns1.host.com</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ns1.host.com</span></span><span class="z-meta z-function-call z-arguments z-shell">    internet address = 192.160.0.100</span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> ls <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">host.com</span></span><span class="z-meta z-function-call z-arguments z-shell">                                       //列出host.com的基本记录</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[[192.168.0.100]]</span></span>
</span><span class="z-source z-shell z-bash"> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell">                      NS     server = ns1.host.com</span>
</span><span class="z-source z-shell z-bash"> <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-bind z-shell">bind</span></span><span class="z-meta z-function-call z-arguments z-shell">                           A      192.160.0.100</span>
</span><span class="z-source z-shell z-bash"> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">dns</span></span><span class="z-meta z-function-call z-arguments z-shell">                            A      192.160.0.100</span>
</span><span class="z-source z-shell z-bash"> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ns1</span></span><span class="z-meta z-function-call z-arguments z-shell">                            A      192.160.0.100</span>
</span><span class="z-source z-shell z-bash"> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">www</span></span><span class="z-meta z-function-call z-arguments z-shell">                            A      192.160.0.100</span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span>
</span></code></pre>
<h2 id="pei-zhi-yi-ge-fan-xiang-jie-xi-yu">配置一个反向解析域</h2>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# tail<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>n5</span> /etc/named.rfc1912.zones    //查看区域配置文件</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">zone</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>0.168.192.in-addr.arpa<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> IN <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        type master;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        file <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>0.168.192.in-addr.zone<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        allow-update <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> none; <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# cat /var/named/0.168.192.in-addr.zone              //查看区域的解析文件</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">0.168.192.in-addr.arpa.</span></span><span class="z-meta z-function-call z-arguments z-shell"> 600 IN SOA ns1.host.com. chai.simplefish.cn. (</span>
</span><span class="z-source z-shell z-bash">                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">202212101</span></span>      <span class="z-keyword z-operator z-logical z-continue z-shell">;</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">序列号，每次更新记录则需要修改</span></span>
</span><span class="z-source z-shell z-bash">                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">10800</span></span>          <span class="z-keyword z-operator z-logical z-continue z-shell">;</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">刷新时间，没隔多久到主服务器更新一次</span></span>
</span><span class="z-source z-shell z-bash">                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">900</span></span>            <span class="z-keyword z-operator z-logical z-continue z-shell">;</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">重试时间，应该小于刷新时间</span></span>
</span><span class="z-source z-shell z-bash">                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">604800</span></span>         <span class="z-keyword z-operator z-logical z-continue z-shell">;</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">过期时间，当辅助dns服务器无法联系主服务器的时间</span></span>
</span><span class="z-source z-shell z-bash">                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">86400</span></span>          <span class="z-keyword z-operator z-logical z-continue z-shell">;</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">非权威应答的ttl，缓存DNS记录多长时间</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"></span>)
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">0.168.192.in-addr.arpa.</span></span><span class="z-meta z-function-call z-arguments z-shell"> 600 IN NS ns1.host.com.</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">100.0.168.192.in-addr.arpa.</span></span><span class="z-meta z-function-call z-arguments z-shell"> 600 IN PTR dns.host.com.</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">100.0.168.192.in-addr.arpa.</span></span><span class="z-meta z-function-call z-arguments z-shell"> 600 IN PTR bind.host.com.</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">100.0.168.192.in-addr.arpa.</span></span><span class="z-meta z-function-call z-arguments z-shell"> 600 IN PTR www.host.com.</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# systemctl restart named</span>
</span></code></pre>
<p>和正向解析的写法略有差别，反向解析的去域名是网段反写加in-addr.arpa，然后解析记录文件也是必须要写SOA记录和NS记录的，反向解析的记录类型为PTR。然后依旧是必须带根域"."。</p>
<h2 id="ce-shi-1">测试</h2>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">C:<span class="z-constant z-character z-escape z-shell">\U</span>sers<span class="z-constant z-character z-escape z-shell">\S</span>impleFish</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span>nslookup</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">默认服务器:</span></span><span class="z-meta z-function-call z-arguments z-shell">  public1.114dns.com</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Address:</span></span><span class="z-meta z-function-call z-arguments z-shell">  114.114.114.114</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> server <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">192.168.0.100</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">默认服务器:</span></span><span class="z-meta z-function-call z-arguments z-shell">  <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>192.168<span class="z-punctuation z-separator z-collate z-begin z-shell">.</span>0<span class="z-punctuation z-separator z-collate z-end z-shell">.</span>100<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Address:</span></span><span class="z-meta z-function-call z-arguments z-shell">  192.168.0.100</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> set <span class="z-variable z-other z-readwrite z-assignment z-shell">type</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">PTR</span>         <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">//设置类型为PTR反向解析记录</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> <span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">192</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">.168.0.100</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">服务器:</span></span><span class="z-meta z-function-call z-arguments z-shell">  <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>192.168<span class="z-punctuation z-separator z-collate z-begin z-shell">.</span>0<span class="z-punctuation z-separator z-collate z-end z-shell">.</span>100<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Address:</span></span><span class="z-meta z-function-call z-arguments z-shell">  192.168.0.100</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">100.0.168.192.in-addr.arpa</span></span><span class="z-meta z-function-call z-arguments z-shell">      name = dns.host.com</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">100.0.168.192.in-addr.arpa</span></span><span class="z-meta z-function-call z-arguments z-shell">      name = www.host.com</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">100.0.168.192.in-addr.arpa</span></span><span class="z-meta z-function-call z-arguments z-shell">      name = bind.host.com</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">0.168.192.in-addr.arpa</span></span><span class="z-meta z-function-call z-arguments z-shell">  nameserver = ns1.host.com</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ns1.host.com</span></span><span class="z-meta z-function-call z-arguments z-shell">    internet address = 192.160.0.100</span>
</span></code></pre>
<h1 id="wei-pai-dns">委派DNS</h1>
<p>委派DNS的意思实质上就是指自己域名的下一级域名交给另一台主机来管理，也可以叫做子域。具体配置如下</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@linux-1</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# tail<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>n</span> 5 /etc/named.rfc1912.zones</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">zone</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>host.com.<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> IN <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        type master;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        file <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>host.com.zone<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        allow-update <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> none; <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@linux-1</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# cat /var/named/host.com.zone</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell"> 600   IN SOA  dns1.host.com. chai.simplefish.cn. (</span>
</span><span class="z-source z-shell z-bash">                                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">0</span></span>       <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">serial</span></span>
</span><span class="z-source z-shell z-bash">                                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">10800</span></span>   <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">refresh</span></span>
</span><span class="z-source z-shell z-bash">                                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">900</span></span>     <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">retry</span></span>
</span><span class="z-source z-shell z-bash">                                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">604800</span></span>  <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">expire</span></span>
</span><span class="z-source z-shell z-bash">                                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">86400</span></span><span class="z-meta z-function-call z-arguments z-shell"> </span><span class="z-meta z-function-call z-shell"></span>) <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">minimum</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell">               600 IN NS ns1.host.com.</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">dns1.host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell">          60 IN A 192.168.1.111</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ns1.host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell">           60 IN A 192.168.1.111</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">www.host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell">           60 IN A 192.168.1.111</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">shanghai.host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell">      600 IN NS ns2.host.com.</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ns2.host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell">           60 IN A 192.168.1.112</span>
</span></code></pre>
<p>把需要委托的下一级域名指定一条NS记录，记录指向委派的主机，上面是把shanghai.host.com这个三级域委派给192.168.1.112主机
再来看一下被委派主机的配置</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@linux-2</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# tail<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>5</span> /etc/named.rfc1912.zones</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">zone</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>shanghai.host.com.<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> IN <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        type master;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        file <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>shanghai.host.com.zone<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        allow-update <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> none; <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@linux-2</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# cat /var/named/shanghai.host.com.zone</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">shanghai.host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell"> 600  IN SOA  dns1.shanghai.host.com. chai.simplefish.cn. (</span>
</span><span class="z-source z-shell z-bash">                                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">0</span></span>       <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">serial</span></span>
</span><span class="z-source z-shell z-bash">                                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">1D</span></span>      <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">refresh</span></span>
</span><span class="z-source z-shell z-bash">                                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">1H</span></span>      <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">retry</span></span>
</span><span class="z-source z-shell z-bash">                                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">1W</span></span>      <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">expire</span></span>
</span><span class="z-source z-shell z-bash">                                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">3H</span></span><span class="z-meta z-function-call z-arguments z-shell"> </span><span class="z-meta z-function-call z-shell"></span>)    <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">minimum</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">shanghai.host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell">                      600 IN NS ns1.shanghai.host.com.</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ns1.shanghai.host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell">                  60 IN A 192.168.1.112</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">dns1.shanghai.host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell">                 60 IN A 192.168.1.112</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">www.shanghai.host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell">                  60 IN A 192.168.1.112</span>
</span></code></pre>
<p>被委派的则就可以正常配置，测试的话只需要指定第一台dns即可查询到委派的信息
第三台主机测试如下</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@linux-3</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# dig<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>t</span> A www.host.com @192.168.1.111 +short</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">192.168.1.111</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@linux-3</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# dig<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>t</span> A www.shanghai.host.com @192.168.1.111 +short</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">192.168.1.112</span></span>
</span></code></pre>
<h1 id="fu-zhu-dns">辅助DNS</h1>
<p>主DNS的配置需要修改的参数如下</p>
<ul>
<li><code>listen-on port 53 { 服务器的IP; };</code>    //监听的ipv4端口以及ip，需要改成自己的主机ip</li>
<li><code>allow-query     { any; };</code>    //允许查询的ip,需要改为any</li>
<li><code>allow-transfer  { 辅助DNS服务器的IP };</code>      //允许同步自己信息的服务器，默认没有这个参数需要在主配置文件的options {}里面添加，这个参数可以写在区域文件里面。</li>
<li><code>also-notify   { 辅助DNS服务器的IP };</code>      //当服务器记录更新时通知对应设置的服务器，默认没有这个参数需要在主配置文件的options {}里面添加，这个参数可以写在区域文件里面。</li>
</ul>
<p>辅助DNS的配置需要修改的参数如下</p>
<ul>
<li><code>listen-on port 53 { 服务器的IP; };</code>    //监听的ipv4端口以及ip，需要改成自己的主机ip</li>
<li><code>allow-query     { any; };</code>    //允许查询的ip,需要改为any</li>
<li><code>masterfile-format text;</code>    //设置同步到本地的文件格式，默认没有这个参数需要在主配置文件的options {}里面添加</li>
</ul>
<p>主DNS的区域配置和解析配置如下</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@master</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# tail<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>n5</span> /etc/named.rfc1912.zones</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">zone</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>host.com.<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> IN <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        type master;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        file <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>host.com.zone<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        allow-update <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> none; <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@master</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# cat /var/named/host.com.zone</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell"> 600 IN SOA ns1.host.com. chai.simplefish.cn. (</span>
</span><span class="z-source z-shell z-bash">                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">202212201</span></span>      <span class="z-keyword z-operator z-logical z-continue z-shell">;</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">序列号，每次更新记录则需要修改</span></span>
</span><span class="z-source z-shell z-bash">                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">10800</span></span>          <span class="z-keyword z-operator z-logical z-continue z-shell">;</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">刷新时间，没隔多久到主服务器更新一次</span></span>
</span><span class="z-source z-shell z-bash">                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">900</span></span>            <span class="z-keyword z-operator z-logical z-continue z-shell">;</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">重试时间，应该小于刷新时间</span></span>
</span><span class="z-source z-shell z-bash">                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">604800</span></span>         <span class="z-keyword z-operator z-logical z-continue z-shell">;</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">过期时间，当辅助dns服务器无法联系主服务器的时间</span></span>
</span><span class="z-source z-shell z-bash">                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">86400</span></span>          <span class="z-keyword z-operator z-logical z-continue z-shell">;</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">非权威应答的ttl，缓存DNS记录多长时间</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"></span>)
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell"> 600 IN NS ns1.host.com.</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ns1.host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell"> 60 IN A 192.160.0.101</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">dns.host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell"> 60 IN A 192.160.0.101</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">bind.host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell"> 60 IN A 192.160.0.101</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">www.host.com.</span></span><span class="z-meta z-function-call z-arguments z-shell"> 60 IN A 192.160.0.101</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@master</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# systemctl restart named</span>
</span></code></pre>
<p>辅助DNS的区域配置和解析配置如下</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@slave</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# tail<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>n5</span> /etc/named.rfc1912.zones</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">zone</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>host.com.<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> IN <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        type slave;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        masters <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> 192.168.0.101; <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        file <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>slaves/host.com.zone<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@slave</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# systemctl restart named</span>
</span></code></pre>
<p>辅助DNS只需要写一个区域配置即可，解析记录它会自动同步。
这里类型设置成了slave
masters是设置主DNS服务器的IP
file这里设置了一个路径是slaves这个路径是可以自己改的，如果要改的话权限一定对的上不然可能会出问题，我建议就是创建的文件或者目录的用户和属组都换成named
刷新成功后他会在<code>/var/named/slaves</code>下生成对应的文件</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@slave</span></span><span class="z-meta z-function-call z-arguments z-shell"> slaves]# pwd</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">/var/named/slaves</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@slave</span></span><span class="z-meta z-function-call z-arguments z-shell"> slaves]# cat host.com.zone</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell"><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">ORIGIN</span></span></span></span><span class="z-meta z-function-call z-arguments z-shell"> .</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell"><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">TTL</span></span></span></span><span class="z-meta z-function-call z-arguments z-shell"> 600</span>        <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">10</span></span><span class="z-meta z-function-call z-arguments z-shell"> minutes</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">host.com</span></span><span class="z-meta z-function-call z-arguments z-shell">                IN SOA  ns1.host.com. chai.simplefish.cn. (</span>
</span><span class="z-source z-shell z-bash">                                <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">202212201</span></span>  <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">serial</span></span>
</span><span class="z-source z-shell z-bash">                                <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">10800</span></span>      <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">refresh</span></span><span class="z-meta z-function-call z-arguments z-shell"> (3 hours</span><span class="z-meta z-function-call z-shell"></span>)
</span><span class="z-source z-shell z-bash">                                <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">900</span></span>        <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">retry</span></span><span class="z-meta z-function-call z-arguments z-shell"> (15 minutes</span><span class="z-meta z-function-call z-shell"></span>)
</span><span class="z-source z-shell z-bash">                                <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">604800</span></span>     <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">expire</span></span><span class="z-meta z-function-call z-arguments z-shell"> (1 week</span><span class="z-meta z-function-call z-shell"></span>)
</span><span class="z-source z-shell z-bash">                                <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">86400</span></span>      <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">minimum</span></span><span class="z-meta z-function-call z-arguments z-shell"> (1 day</span><span class="z-meta z-function-call z-shell"></span>)
</span><span class="z-source z-shell z-bash">                                <span class="z-meta z-function-call z-shell"></span>)
</span><span class="z-source z-shell z-bash">                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">NS</span></span><span class="z-meta z-function-call z-arguments z-shell">      ns1.host.com.</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell"><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">ORIGIN</span></span></span></span><span class="z-meta z-function-call z-arguments z-shell"> host.com.</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell"><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">TTL</span></span></span></span><span class="z-meta z-function-call z-arguments z-shell"> 60</span> <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">1</span></span><span class="z-meta z-function-call z-arguments z-shell"> minute</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-bind z-shell">bind</span></span><span class="z-meta z-function-call z-arguments z-shell">                    A       192.160.0.101</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">dns</span></span><span class="z-meta z-function-call z-arguments z-shell">                     A       192.160.0.101</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ns1</span></span><span class="z-meta z-function-call z-arguments z-shell">                     A       192.160.0.101</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">www</span></span><span class="z-meta z-function-call z-arguments z-shell">                     A       192.160.0.101</span>
</span></code></pre>
<p>他这种是宏定义的方式来同步解析文件这种写法后面也会说一下。反向解析的辅助DNS配置一样域名换一下即可。</p>
<h1 id="zhi-neng-dns">智能DNS</h1>
<p>智能DNS主要作用就是不同的网段去解析一个域名，可以实现解析不同的地址。</p>
<h2 id="aclzu">ACL组</h2>
<p>ACL组可以用来定义一个ip的范围。any参数就是一个acl组，他代表的是全部的IP。定义方式如下</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">acl</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>acl_name<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        acl_name;        //其他的acl组
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        192.168.0.0/24;  //网段
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        !192.168.0.2;   //不包括192.168.0.2这个ip
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>                        //添加ip组
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">                192.168.1.2;
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">                192.168.1.3;
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span></code></pre>
<h2 id="viewshi-tu">view视图</h2>
<p>view视图可以对acl组单独设置dns的区域解析。写法方式如下</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">view</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>view_name<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>                     //设置view视图的名称
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">    match-clients <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> acl组; <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span>;          //设置acl组
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">    recursion yes;                     //允许递归查询
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">    zone <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>host.com.<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>                 //正常写zone区域
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        type master;
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        file <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>host.com.zone<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        allow-update <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> none; <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span>;
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">    <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span></code></pre>
<p>如果要使用view视图那么就需要把所有的区域都放到view视图里面，除了自己设置的默认还有一个默认的view视图，名称为"default",需要把根域"."加进去以及<code>/etc/named.rfc1912.zones</code>里的所有zone。</p>
<h2 id="pei-zhi">配置</h2>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> named]# tail<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>n14</span> /etc/named.conf //查看主配置文件。</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">include</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/etc/named-view.conf<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>     <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">//引入我自己创建的视图文件</span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">view</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>default<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        match-clients <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> any; <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        recursion yes;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        zone <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>.<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> IN <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">                type hint;
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">                file <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>named.ca<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        include <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/etc/named.rfc1912.zones<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">include</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/etc/named.root.key<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> named]# cat /etc/named-view.conf          //查看我自己创建的视图文件内容</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">acl</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>test01<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">                192.168.0.101;                   //定义acl test01
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">acl</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>test02<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">                192.168.0.107;                   //定义acl test02
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">view</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>test01<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>                                  //配置视图test01
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        match-clients <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> test01; <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        recursion yes;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        zone <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>host.com.<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">                type master;
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">                file <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>host.com.test01.zone<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">                allow-update <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> none; <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span>;
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">view</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>test02<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>                                 //配置视图test02
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        match-clients <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> test02; <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        recursion yes;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        zone <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>host.com.<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">                type master;
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">                file <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>host.com.test02.zone<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">                allow-update <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> none; <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span>;
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span></code></pre>
<p>我把根域和named.rfc1912.zones里的所有域都放到了default视图里面。然后我还引入了一个文件用来专门放acl和view的文件，配置文件是有前后之分的如果把"default"视图放到前面则都只会匹配"default"视图所以我把它放到了前面，文件里定义了两个acl，分别是两个ip，之后分别配置了一个视图，视图里都是同一个域名但是解析文件不一样。当匹配到acl规则之后会走对应的解析文件。否则走"default"视图。</p>
<h1 id="gong-wang-dns">公网DNS</h1>
<p>因为BIND软件开源所以公网dns涉及到一个安全的问题，就有了BIND-CHROOT这个东西，当运行的时候bind会在另一个根下运行，当服务器因为DNS某些漏洞被黑入的时候他也只能在这个根下操作。从而保证整个服务器的数据安全。
配置bind-chroot的方式</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# yum<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>y</span> install bind</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# yum<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>y</span> install bind-chroot</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# cd /var/named/chroot/etc/</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> etc]# ln /etc/named<span class="z-keyword z-operator z-regexp z-quantifier z-shell">*</span> ./</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ln:</span></span><span class="z-meta z-function-call z-arguments z-shell"> /etc/named: hard link not allowed for directory</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> etc]# cd ../var/named/</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> named]# ln /var/named/<span class="z-keyword z-operator z-regexp z-quantifier z-shell">*</span> ./</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ln:</span></span><span class="z-meta z-function-call z-arguments z-shell"> /var/named/chroot: hard link not allowed for directory</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ln:</span></span><span class="z-meta z-function-call z-arguments z-shell"> /var/named/data: hard link not allowed for directory</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ln:</span></span><span class="z-meta z-function-call z-arguments z-shell"> /var/named/dynamic: hard link not allowed for directory</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ln:</span></span><span class="z-meta z-function-call z-arguments z-shell"> /var/named/slaves: hard link not allowed for directory</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> named]# mkdir data dynamic slaves</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> named]# chown named:named data dynamic slaves</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> named]# systemctl start named-chroot</span>
</span></code></pre>
<p>装好bind-chroot之后需要把原来的文件结构都搞到<code>/var/named/chroot</code>下这个chroot下就是一个服务运行的根，开启时服务名称改为named-chroot，文件结构不管是复制还是剪切都可以只要有对应结构的文件都在就行，我这里做的是硬链接，往后的配置都需要在<code>/var/named/chroot/</code>这个根下面进行。</p>
<h1 id="bind-utilsgong-ju-bao">BIND-UTILS工具包</h1>
<h2 id="an-zhuang-1">安装</h2>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> named]# yum<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>y</span> install bind-utils</span>
</span></code></pre>
<h2 id="nslookup">nslookup</h2>
<p><strong>非交互式</strong></p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">nslookup</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>解析的域名<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# nslookup ns1.host.com</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Server:</span></span><span class="z-meta z-function-call z-arguments z-shell">         192.168.0.105</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Address:</span></span><span class="z-meta z-function-call z-arguments z-shell">        192.168.0.105#53</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Name:</span></span><span class="z-meta z-function-call z-arguments z-shell">   ns1.host.com</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Address:</span></span><span class="z-meta z-function-call z-arguments z-shell"> 192.168.0.105</span>
</span></code></pre>
<p><strong>交互式</strong></p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# nslookup</span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> server <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">192.168.0.105</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Default</span></span><span class="z-meta z-function-call z-arguments z-shell"> server: 192.168.0.105</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Address:</span></span><span class="z-meta z-function-call z-arguments z-shell"> 192.168.0.105#53</span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> www.host.com
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Server:</span></span><span class="z-meta z-function-call z-arguments z-shell">         192.168.0.105</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Address:</span></span><span class="z-meta z-function-call z-arguments z-shell">        192.168.0.105#53</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Name:</span></span><span class="z-meta z-function-call z-arguments z-shell">   www.host.com</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Address:</span></span><span class="z-meta z-function-call z-arguments z-shell"> 192.168.0.105</span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> set <span class="z-variable z-other z-readwrite z-assignment z-shell">type</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">SOA</span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> host.com
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Server:</span></span><span class="z-meta z-function-call z-arguments z-shell">         192.168.0.105</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Address:</span></span><span class="z-meta z-function-call z-arguments z-shell">        192.168.0.105#53</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">host.com</span></span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">origin</span></span><span class="z-meta z-function-call z-arguments z-shell"> = ns1.host.com</span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">mail</span></span><span class="z-meta z-function-call z-arguments z-shell"> addr = chai.simplefish.cn</span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">serial</span></span><span class="z-meta z-function-call z-arguments z-shell"> = 0</span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">refresh</span></span><span class="z-meta z-function-call z-arguments z-shell"> = 86400</span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">retry</span></span><span class="z-meta z-function-call z-arguments z-shell"> = 86400</span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">expire</span></span><span class="z-meta z-function-call z-arguments z-shell"> = 86400</span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">minimum</span></span><span class="z-meta z-function-call z-arguments z-shell"> = 86400</span>
</span></code></pre>
<h2 id="host">host</h2>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">host</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>t</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>类型<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>域名<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>DNS地址<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# host<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>t</span> A www.host.com 192.168.0.105</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Using</span></span><span class="z-meta z-function-call z-arguments z-shell"> domain server:</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Name:</span></span><span class="z-meta z-function-call z-arguments z-shell"> 192.168.0.105</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Address:</span></span><span class="z-meta z-function-call z-arguments z-shell"> 192.168.0.105#53</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Aliases:</span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">www.host.com</span></span><span class="z-meta z-function-call z-arguments z-shell"> has address 192.168.0.105</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# host<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>t</span> ns host.com 192.168.0.105</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Using</span></span><span class="z-meta z-function-call z-arguments z-shell"> domain server:</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Name:</span></span><span class="z-meta z-function-call z-arguments z-shell"> 192.168.0.105</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Address:</span></span><span class="z-meta z-function-call z-arguments z-shell"> 192.168.0.105#53</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Aliases:</span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">host.com</span></span><span class="z-meta z-function-call z-arguments z-shell"> name server ns1.host.com.</span>
</span></code></pre>
<h2 id="dig">dig</h2>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">dig</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>t</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>类型<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>域名<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> @<span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>DNS地址<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> 参数</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">+short</span></span><span class="z-meta z-function-call z-arguments z-shell">  返回精简结果</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">-x</span></span><span class="z-meta z-function-call z-arguments z-shell">      进行逆向域名查询</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">+noall</span></span><span class="z-meta z-function-call z-arguments z-shell">  忽略全部，不进行输出</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">+answer</span></span><span class="z-meta z-function-call z-arguments z-shell"> 只输出结果，省略过程</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">+trace：进行迭代查</span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# dig<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>t</span> A www.host.com @192.168.0.105</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">&lt;</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">&lt;</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;&gt;</span> DiG <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">9.11.26-RedHat-9.11.26-6.el8</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-keyword z-operator z-assignment z-redirection z-shell">&lt;</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">&lt;</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;&gt;</span> <span class="z-punctuation z-terminator z-file-descriptor z-shell">-</span>t A www.host.com @192.168.0.105</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"></span>;<span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">global</span></span><span class="z-meta z-function-call z-arguments z-shell"> options: +cmd</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"></span>;<span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Got</span></span><span class="z-meta z-function-call z-arguments z-shell"> answer:</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"></span>;<span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">-</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;&gt;</span>HEADER<span class="z-string z-unquoted z-heredoc z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&lt;&lt;-</span> <span class="z-keyword z-control z-heredoc-token z-shell">opcode</span></span><span class="z-meta z-function-call z-arguments z-shell">: QUERY, status: NOERROR, id: 47724</span><span class="z-string z-unquoted z-heredoc z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 2
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">;; OPT PSEUDOSECTION:
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">; EDNS: version: 0, flags:; udp: 1232
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">; COOKIE: d97935613cf3169f270c53e061ed0fe27016722968769c4a (good)
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">;; QUESTION SECTION:                           //说明查询内容
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">;www.host.com.                  IN      A
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">;; ANSWER SECTION:                             //查询结果
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">www.host.com.           60      IN      A       192.168.0.105
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">;; AUTHORITY SECTION:                          //查询附加内容
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">host.com.               600     IN      NS      ns1.host.com.
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">;; ADDITIONAL SECTION:                         //查询附加内容
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">ns1.host.com.           60      IN      A       192.168.0.105
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">;; Query time: 0 msec
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">;; SERVER: 192.168.0.105#53(192.168.0.105)
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">;; WHEN: Sun Jan 23 03:20:50 EST 2022
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">;; MSG SIZE  rcvd: 119
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">[root@localhost ~]# dig -t A www.host.com @192.168.0.105 +short
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">192.168.0.105
</span></span></span></code></pre>
<h2 id="nsupdate">nsupdate</h2>
<p>nsupdate是用来添加和删除记录，不支持修改记录。使用方法只能是交互式使用。使用命令前需要把区域的allow-update参数修改一下，改成使用nsupdate主机的ip即可。可以使用acl。</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# tail<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>n5</span> /etc/named.rfc1912.zones</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">zone</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>host.com.<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> IN <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        type master;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        file <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>host.com.zone<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        allow-update <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> 192.168.0.105; <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span>;                 //修改允许动态更新的ip地址
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# systemctl restart named              //重启生效</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# nsupdate</span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> server <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">192.168.0.105</span></span><span class="z-meta z-function-call z-arguments z-shell">                                      //指定DNS服务器地址</span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> update <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">add</span></span><span class="z-meta z-function-call z-arguments z-shell"> server.host.com 60 A 192.168.0.105             //add就是添加 之后写一条记录 记录写法很严格给必须是<span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>记录 TTL 记录类型 记录值<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> send                              <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">//更新</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> quit                              <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">//退出</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# dig<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>t</span> A server.host.com @192.168.0.105 +short</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">192.168.0.105</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# nsupdate</span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> server <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">192.168.0.105</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> update <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">del</span></span><span class="z-meta z-function-call z-arguments z-shell"> server.host.com                   //del为删除删除记录</span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> send
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> quit
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# dig<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>t</span> A server.host.com @192.168.0.105 +short</span>
</span></code></pre>
<p>是用这个命令不会在自己创建的记录文件里添加记录，而是会生成一个jnl日志文件，正常编辑为乱码。</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> named]# cat host.com.zone.jnl</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">BIND</span></span><span class="z-meta z-function-call z-arguments z-shell"> LOG V9</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">▒8▒▒JhostcomX6ns1hostcomchai</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">simplefishcnQ▒Q▒Q▒Q▒JhostcomX6ns1hostcomchai</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">simplefishcnQ▒Q▒Q▒Q▒serverhostcom</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&lt;</span>▒i▒JhostcomX6ns1hostcomchai</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">simplefishcnQ▒Q▒Q▒Q▒serverhostcom</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&lt;</span>▒iJhostcomX6ns1hostcomchai</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">simplefishcnQ▒Q▒Q▒Q▒[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> named]#</span>
</span></code></pre>
<h1 id="rndcguan-li-bind9">RNDC管理BIND9</h1>
<p>rndc可以对bind9进行热更新，可以对某个域的解析单独进行重载。使用方法如下</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# rndc-confgen</span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Start of rndc.conf</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">key</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>rndc-key<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        algorithm hmac-md5;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        secret <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>e7SaG876PM54+/1bRFh/JQ==<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">options</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        default-key <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>rndc-key<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        default-server 127.0.0.1;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        default-port 953;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> End of rndc.conf</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Use with the following in named.conf, adjusting the allow list as needed:</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> key &quot;rndc-key&quot; {</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell">       algorithm hmac-md5;</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell">       secret &quot;e7SaG876PM54+/1bRFh/JQ==&quot;;</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> };</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> controls {</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell">       inet 127.0.0.1 port 953</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell">               allow { 127.0.0.1; } keys { &quot;rndc-key&quot;; };</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> };</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> End of named.conf</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></code></pre>
<p>rndc-confgen这个命令会生成两段配置，使用"#"注释的配置字段需要放到服务端的配置文件里，未注释的字段需要放到控制端进行配置。</p>
<p><strong>服务端配置</strong></p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# tail<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>n8</span> /etc/named.conf</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">key</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>rndc-key<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        algorithm hmac-md5;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        secret <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>e7SaG876PM54+/1bRFh/JQ==<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">controls</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        inet 192.168.0.105 port 953                //这个地址需要修改成DNS服务器的主机地址
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">        allow <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> any; <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span> keys <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>rndc-key<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>; <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span>;       //这个allow <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span> 是允许谁来进行操作，我这里写的any意思为全部，不建议这样搞建议写成控制端的ip。
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# systemctl restart named</span>
</span></code></pre>
<p><strong>控制端配置</strong></p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# cat /etc/rndc.conf</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">key</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>rndc-key<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">                algorithm hmac-md5;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">                secret <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>e7SaG876PM54+/1bRFh/JQ==<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">options</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">                default-key <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>rndc-key<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span>;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">                default-server 192.168.0.105;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell">                default-port 953;
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# rm<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>rf</span> /etc/rndc.key        //默认系统里会自带一个rndc的key删除即可</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# rndc status                     //查看状态，不报错就可以用了</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">version:</span></span><span class="z-meta z-function-call z-arguments z-shell"> BIND 9.11.26-RedHat-9.11.26-6.el8 (Extended Support Version</span><span class="z-meta z-function-call z-shell"></span>) <span class="z-keyword z-operator z-assignment z-redirection z-shell">&lt;</span>id:3ff8620<span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">running</span></span><span class="z-meta z-function-call z-arguments z-shell"> on localhost.localdomain: Linux x86_64 4.18.0-305.3.1.el8.x86_64 <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell">1 SMP Tue Jun 1 16:14:33 UTC 2021</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">boot</span></span><span class="z-meta z-function-call z-arguments z-shell"> time: Sun, 23 Jan 2022 10:21:45 GMT</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">last</span></span><span class="z-meta z-function-call z-arguments z-shell"> configured: Sun, 23 Jan 2022 10:21:45 GMT</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">configuration</span></span><span class="z-meta z-function-call z-arguments z-shell"> file: /etc/named.conf</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">CPUs</span></span><span class="z-meta z-function-call z-arguments z-shell"> found: 1</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">worker</span></span><span class="z-meta z-function-call z-arguments z-shell"> threads: 1</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">UDP</span></span><span class="z-meta z-function-call z-arguments z-shell"> listeners per interface: 1</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">number</span></span><span class="z-meta z-function-call z-arguments z-shell"> of zones: 104 (97 automatic</span><span class="z-meta z-function-call z-shell"></span>)
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">debug</span></span><span class="z-meta z-function-call z-arguments z-shell"> level: 0</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">xfers</span></span><span class="z-meta z-function-call z-arguments z-shell"> running: 0</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">xfers</span></span><span class="z-meta z-function-call z-arguments z-shell"> deferred: 0</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">soa</span></span><span class="z-meta z-function-call z-arguments z-shell"> queries in progress: 0</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">query</span></span><span class="z-meta z-function-call z-arguments z-shell"> logging is OFF</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">recursive</span></span><span class="z-meta z-function-call z-arguments z-shell"> clients: 0/900/1000</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">tcp</span></span><span class="z-meta z-function-call z-arguments z-shell"> clients: 3/150</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">TCP</span></span><span class="z-meta z-function-call z-arguments z-shell"> high-water: 3</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">server</span></span><span class="z-meta z-function-call z-arguments z-shell"> is up and running</span>
</span></code></pre>
<p>这是基本的配置，使用方式如下</p>
<p><strong>不允许动态更新的域</strong></p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">allow-update</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> none; <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">//配置区域的时候这个参数为none</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# dig<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>t</span> A a.host.com @192.168.0.105 +short</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# echo <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>a                       A       192.168.0.105<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;&gt;</span> /var/named/host.com.zone</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# rndc reload host.com</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">zone</span></span><span class="z-meta z-function-call z-arguments z-shell"> reload queued</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# dig<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>t</span> A a.host.com @192.168.0.105 +short</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">192.168.0.105</span></span>
</span></code></pre>
<p><strong>允许动态更新的域</strong></p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">allow-update</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span> IP; <span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">//配置区域的时候这个参数有内容</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# dig<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>t</span> A b.host.com @192.168.0.105 +short</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# echo <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>b                       A       192.168.0.105<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;&gt;</span> /var/named/host.com.zone</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# rndc freeze host.com     //冻结这个动态域</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# rndc reload host.com     //重载</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">zone</span></span><span class="z-meta z-function-call z-arguments z-shell"> reload queued</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# rndc thaw host.com       //启用动态域</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">The</span></span><span class="z-meta z-function-call z-arguments z-shell"> zone reload and thaw was successful.</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@localhost</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# dig<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>t</span> A b.host.com @192.168.0.105 +short</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">192.168.0.105</span></span>
</span></code></pre>
<h1 id="qi-ta">其他</h1>
<h2 id="hong-ding-yi-xie-fa">宏定义写法</h2>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell"><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">ORIGIN</span></span></span></span><span class="z-meta z-function-call z-arguments z-shell"> .                            //宏定义根域</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell"><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">TTL</span></span></span></span><span class="z-meta z-function-call z-arguments z-shell"> 600</span>        <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">10</span></span><span class="z-meta z-function-call z-arguments z-shell"> minutes         //宏定义TTL值</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">//定义之后的就可以不用谢TTL和根域了，就和这条SOA记录一样，他会自动的在域名后面加根域和TTL</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">host.com</span></span><span class="z-meta z-function-call z-arguments z-shell">                IN SOA  ns1.host.com. chai.simplefish.cn. (</span>
</span><span class="z-source z-shell z-bash">                                <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">2</span></span>          <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">serial</span></span>
</span><span class="z-source z-shell z-bash">                                <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">86400</span></span>      <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">refresh</span></span><span class="z-meta z-function-call z-arguments z-shell"> (1 day</span><span class="z-meta z-function-call z-shell"></span>)
</span><span class="z-source z-shell z-bash">                                <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">86400</span></span>      <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">retry</span></span><span class="z-meta z-function-call z-arguments z-shell"> (1 day</span><span class="z-meta z-function-call z-shell"></span>)
</span><span class="z-source z-shell z-bash">                                <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">86400</span></span>      <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">expire</span></span><span class="z-meta z-function-call z-arguments z-shell"> (1 day</span><span class="z-meta z-function-call z-shell"></span>)
</span><span class="z-source z-shell z-bash">                                <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">86400</span></span>      <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">minimum</span></span><span class="z-meta z-function-call z-arguments z-shell"> (1 day</span><span class="z-meta z-function-call z-shell"></span>)
</span><span class="z-source z-shell z-bash">                                <span class="z-meta z-function-call z-shell"></span>)
</span><span class="z-source z-shell z-bash">                        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">NS</span></span><span class="z-meta z-function-call z-arguments z-shell">      ns1.host.com.</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell"><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">ORIGIN</span></span></span></span><span class="z-meta z-function-call z-arguments z-shell"> host.com.                          //重新定义域名</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell"><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">TTL</span></span></span></span><span class="z-meta z-function-call z-arguments z-shell"> 60</span> <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">1</span></span><span class="z-meta z-function-call z-arguments z-shell"> minute                         //重新定义TTL</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">dns</span></span><span class="z-meta z-function-call z-arguments z-shell">                     A       192.168.0.105      //域名则可以省略掉宏定义的内容</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ns1</span></span><span class="z-meta z-function-call z-arguments z-shell">                     A       192.168.0.105</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">www</span></span><span class="z-meta z-function-call z-arguments z-shell">                     A       192.168.0.105</span>
</span></code></pre>
<h2 id="ru-he-yan-zheng-wo-de-pei-zhi">如何验证我的配置？</h2>
<p>使用nslookup，host，dig，ping都可以来验证自己配置的DNS服务器，如果服务器可以重启依旧不同则可以依次检查服务器的防火墙、网络互通性、客户端的DNS是否为服务端来解决问题。</p>

        </section>
        
        

        
            
            
            

            
        
            
            
            

            
        
            
            
            

            
        
            
            
            

            
        
        </article>
</main>

    <div id="button-container">
        
        
            <div id="toc-floating-container">
                <input type="checkbox" id="toc-toggle" class="toggle"/>
                <label for="toc-toggle" class="overlay"></label>
                <label for="toc-toggle" id="toc-button" class="button" title="Toggle Table of Contents">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M414.82-193.094q-18.044 0-30.497-12.32-12.453-12.319-12.453-30.036t12.453-30.086q12.453-12.37 30.497-12.37h392.767q17.237 0 29.927 12.487 12.69 12.486 12.69 30.203 0 17.716-12.69 29.919t-29.927 12.203H414.82Zm0-244.833q-18.044 0-30.497-12.487Q371.87-462.9 371.87-480.45t12.453-29.92q12.453-12.369 30.497-12.369h392.767q17.237 0 29.927 12.511 12.69 12.512 12.69 29.845 0 17.716-12.69 30.086-12.69 12.37-29.927 12.37H414.82Zm0-245.167q-18.044 0-30.497-12.32t-12.453-30.037q0-17.716 12.453-30.086 12.453-12.369 30.497-12.369h392.767q17.237 0 29.927 12.486 12.69 12.487 12.69 30.203 0 17.717-12.69 29.92-12.69 12.203-29.927 12.203H414.82ZM189.379-156.681q-32.652 0-55.878-22.829t-23.226-55.731q0-32.549 23.15-55.647 23.151-23.097 55.95-23.097 32.799 0 55.313 23.484 22.515 23.484 22.515 56.246 0 32.212-22.861 54.893-22.861 22.681-54.963 22.681Zm0-245.167q-32.652 0-55.878-23.134-23.226-23.135-23.226-55.623 0-32.487 23.467-55.517t56.12-23.03q32.102 0 54.721 23.288 22.62 23.288 22.62 55.775 0 32.488-22.861 55.364-22.861 22.877-54.963 22.877Zm-.82-244.833q-32.224 0-55.254-23.288-23.03-23.289-23.03-55.623 0-32.333 23.271-55.364 23.272-23.03 55.495-23.03 32.224 0 55.193 23.288 22.969 23.289 22.969 55.622 0 32.334-23.21 55.364-23.21 23.031-55.434 23.031Z"/></svg>
                </label>
                <div class="toc-content">
                    

<div class="toc-container">
    

    <ul>
        
            
            
                <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#dns">DNS</a>
                    
                </li>
            
        
            
            
                <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#yu-ming">域名</a>
                    
                </li>
            
        
            
            
                <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#bind9">BIND9</a>
                    
                        <ul>
                            
                                
                                    <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#an-zhuang">安装</a>
                                        
                                    </li>
                                
                            
                                
                                    <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#zhu-pei-zhi">主配置</a>
                                        
                                    </li>
                                
                            
                                
                                    <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#ge-chong-lei-xing-de-ji-lu">各种类型的记录</a>
                                        
                                    </li>
                                
                            
                                
                                    <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#pei-zhi-yi-ge-zheng-xiang-jie-xi-yu">配置一个正向解析域</a>
                                        
                                    </li>
                                
                            
                                
                                    <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#ce-shi">测试</a>
                                        
                                    </li>
                                
                            
                                
                                    <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#pei-zhi-yi-ge-fan-xiang-jie-xi-yu">配置一个反向解析域</a>
                                        
                                    </li>
                                
                            
                                
                                    <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#ce-shi-1">测试</a>
                                        
                                    </li>
                                
                            
                        </ul>
                    
                </li>
            
        
            
            
                <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#wei-pai-dns">委派DNS</a>
                    
                </li>
            
        
            
            
                <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#fu-zhu-dns">辅助DNS</a>
                    
                </li>
            
        
            
            
                <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#zhi-neng-dns">智能DNS</a>
                    
                        <ul>
                            
                                
                                    <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#aclzu">ACL组</a>
                                        
                                    </li>
                                
                            
                                
                                    <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#viewshi-tu">view视图</a>
                                        
                                    </li>
                                
                            
                                
                                    <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#pei-zhi">配置</a>
                                        
                                    </li>
                                
                            
                        </ul>
                    
                </li>
            
        
            
            
                <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#gong-wang-dns">公网DNS</a>
                    
                </li>
            
        
            
            
                <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#bind-utilsgong-ju-bao">BIND-UTILS工具包</a>
                    
                        <ul>
                            
                                
                                    <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#an-zhuang-1">安装</a>
                                        
                                    </li>
                                
                            
                                
                                    <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#nslookup">nslookup</a>
                                        
                                    </li>
                                
                            
                                
                                    <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#host">host</a>
                                        
                                    </li>
                                
                            
                                
                                    <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#dig">dig</a>
                                        
                                    </li>
                                
                            
                                
                                    <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#nsupdate">nsupdate</a>
                                        
                                    </li>
                                
                            
                        </ul>
                    
                </li>
            
        
            
            
                <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#rndcguan-li-bind9">RNDC管理BIND9</a>
                    
                </li>
            
        
            
            
                <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#qi-ta">其他</a>
                    
                        <ul>
                            
                                
                                    <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#hong-ding-yi-xie-fa">宏定义写法</a>
                                        
                                    </li>
                                
                            
                                
                                    <li><a href="https://synex.space/blog/bind9-dnsfu-wu-qi/#ru-he-yan-zheng-wo-de-pei-zhi">如何验证我的配置？</a>
                                        
                                    </li>
                                
                            
                        </ul>
                    
                </li>
            
        
    </ul>
</div>


                </div>
            </div>
        

        
        

        
        <a href="#" id="top-button" class="no-hover-padding" title="Go to the top of the page">
            <svg viewBox="0 0 20 20" fill="currentColor"><path d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z"/></svg>
        </a>
    </div>


<span id="copy-success" class="hidden">
        Copied!
    </span>
    <span id="copy-init" class="hidden">
        Copy code to clipboard
    </span>
    <script defer src="https://synex.space/js/copyCodeToClipboard.min.js"></script>


    </div>
    <footer>
    <section>
        <nav class="socials nav-navs">
        </nav>

        
        <nav class="nav-navs">
        </nav>

        <div class="credits">
            <small>
                

                
                Powered by
                <a rel="" 

 href="https://www.getzola.org">Zola</a>
                &amp;
                <a rel="" 

 href="https://github.com/welpo/tabi">tabi</a>

                </small>
        </div>
    </section>

    <div id="searchModal" class="search-modal js" role="dialog" aria-labelledby="modalTitle">
    <h1 id="modalTitle" class="visually-hidden">Search</h1>
    <div id="modal-content">
        <div id="searchBar">
            <div class="search-icon" aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                    <path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/>
                </svg>
            </div>
            <input id="searchInput" role="combobox" autocomplete="off" spellcheck="false" aria-expanded="false" aria-controls="results-container" placeholder="Search…"/>
            <div id="clear-search" class="close-icon interactive-icon" tabindex="0" role="button" title="Clear search">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                <path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/>
                </svg>
            </div>
        </div>
        <div id="results-container">
            <div id="results-info"><span id="zero_results"> No results</span>
                <span id="one_results"> $NUMBER result</span>
                <span id="many_results"> $NUMBER results</span><span id="two_results"> $NUMBER results</span>
                <span id="few_results"> $NUMBER results</span>
            </div>
            <div id="results" role="listbox"></div>
        </div>
    </div>
</div>
</footer>


    
    
</body>

</html>
